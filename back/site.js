var app;(()=>{"use strict";var e={214:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(7252)),s=r(n(7151)),o=r(n(780)),i=a.default.Router();i.post("/save",o.default.isAdminToken,s.default.saveBannerController),i.get("/list",s.default.getBannerController),i.delete("/delete",o.default.isAdminToken,s.default.deleteBannerController),i.put("/update",o.default.isAdminToken,s.default.updateBannerController),i.get("/image_file/show/:fileName",s.default.showImage),t.default=i},218:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if("/"===e.originalUrl)return t.redirect("/");const r=function(){let e=__dirname;for(;;){const t=a.default.join(e,"public");if(s.default.existsSync(t)&&s.default.statSync(t).isDirectory())return t;const n=a.default.dirname(e);if(n===e)break;e=n}return null}();return r?t.sendFile(a.default.join(r,"index.html")):t.status(404).send("Public directory not found")};const a=r(n(2003)),s=r(n(9896))},780:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(4572),s=r(n(5260)),o=r(n(3481)),i=(e,t)=>(0,a.sendError)(e,t,!1,401),u={isAdminToken:async(e,t,n)=>await(async(e,t,n,r)=>{try{const a=e.headers.authorization;if("development"===s.default.NODE_ENV&&console.log("token: ",a),!a)return i(t,e.t("token.notFound"));const u=o.default.getTokenData(a);if(!u)return i(t,e.t("token.invalid"));const l=Date.now();if("development"===s.default.NODE_ENV&&(console.log(Object.assign({},u)),console.log("Token expiration: ",new Date(u.exp)),console.log("Current timestamp: ",new Date(l)),console.log("Is token valid: ",u.exp>l)),u.exp<=l)return i(t,e.t("token.expired"));const d=u.r.map(e=>e.id_role);return await(async(e,t)=>{const n=new Set(e);for(let e of t)if(n.has(e))return!0;return!1})(d,r)?(e.user=u,n()):i(t,e.t("token.permission"))}catch(n){return console.error("CheckToken error:",n.message),i(t,e.t("token.invalid"))}})(e,t,n,[1])};t.default=u},818:e=>{e.exports=require("dotenv")},829:e=>{e.exports=require("jsonwebtoken")},970:e=>{e.exports=JSON.parse('{"token":{"notFound":"Токен не найден!","invalid":"Токен недействительный!","permission":"У вас нет доступа!","expired":"Срок действия токена истек!","generateError":"Не удалось сгенерировать токен"},"success":"Успешно!","error":"Ошибка!","unauth":"Неправильный логин пароль!","inValidFormat":"Неверный формат данных!","noValidEmail":"Неверный адрес электронной почты!","noToken":"Нет токена!","emailUsed":"Email уже используется","userNotFound":"Пользователь не найден","emailAlreadyInUse":"Нельзя поменять на почту, которую вы уже используете","changedNumber":"Номер телефона успешно изменен","couldNotChangeTheNumber":"Не получилось изменить номер","phoneAlreadyInUse":"Нельзя поменять на номер, которую вы уже используете","passwordAlreadyInUse":"Нельзя поменять на тот же пароль, которую вы уже используете","changePassword":"Вы успешно поменяли пароль","couldNotChangeThePassword":"Не получилось поменять пароль","fileIsMissing":"Файл отсутствует","fileNotFound":"Файл не найден!"}')},1235:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(1460)),s=r(n(8416)),o=r(n(6716)),i=r(n(5946)),u=r(n(5260)),l=r(n(5560)),d=r(n(3481)),c=u.default.FILE_POST_PATH;t.default=new class{async getPostByIdController(e,t){try{const{id:n}=e.query,r=Number(n),s=await a.default.getPostById(r);return s?t.status(200).json(s):t.status(404).json({message:"Новости или акции не найдены"})}catch(e){return console.error("error getPostByIdNewController: ",e.message),t.status(500).json({message:"Internal Server Error"})}}async getAllPostsController(e,t){try{const{id:n}=e.params,{page:r=1,offset:s=12}=e.query,o=Number(n),i=Number(r),u=Number(s);if(isNaN(i)||isNaN(u))return t.status(400).json({message:"Некорректные параметры"});const l=e.headers.authorization;let c=!1;if(l){const e=d.default.getTokenData(l);if(!1===e)return t.status(400).json({message:"Invalid or missing token"});c=(e.r||[]).some(e=>"ADMIN"===e.role_name)}const _=await a.default.getAllPosts(o,i,u,c);return _?t.status(200).json(_):t.status(404).json({message:"Новости не найдены"})}catch(e){return console.error("error getAllPostsNewController: ",e.message),t.status(500).json({message:"Internal Server Error"})}}async createController(e,t){var n,r,u,l,d,_;try{const f=[],p=[];if(e.body.contents=f,!(0,s.default)(e.body,o.default.postNewSchema))return t.status(400).json({message:"Неверный формат"});const m=null===(n=e.files)||void 0===n?void 0:n.main_images;if(m){const e=Array.isArray(m)?m:[m];for(const t of e){const e=await i.default.saveFile({path:c,fileName:t.name,sampleFile:t,type:"image"});e.error||p.push(e.dbFileName)}}for(let n=0;;n++){const a=`contents[${n}][description_ru]`,s=`contents[${n}][description_ky]`,o=`contents[${n}][description_en]`;if(!(a in e.body||s in e.body||o in e.body))break;const _=(null===(r=e.body[a])||void 0===r?void 0:r.trim())||null,p=(null===(u=e.body[s])||void 0===u?void 0:u.trim())||null,m=(null===(l=e.body[o])||void 0===l?void 0:l.trim())||null;if(!_&&!p&&!m)return t.status(400).json({message:"Хотя бы одно описание должно быть заполнено"});const g=`images_${n}`,y=null===(d=e.files)||void 0===d?void 0:d[g],E=[];if(Array.isArray(y))for(const e of y){const t=await i.default.saveFile({path:c,fileName:e.name,sampleFile:e,type:"image"});t.error||E.push(t.dbFileName)}else if(y){const e=await i.default.saveFile({path:c,fileName:y.name,sampleFile:y,type:"image"});e.error||E.push(e.dbFileName)}f.push({description_ru:_,description_ky:p,description_en:m,images:E})}if(0===f.length&&0===p.length)return t.status(400).json({message:"Нужно минимум одно описание или главное изображение"});const{id_type:g,title_ru:y,title_ky:E,title_en:h,date:v}=e.body;if(!y&&!E&&!h)return t.status(400).json({message:"Нужно минимум одно название"});const N=Number(g);if(!Number(null===(_=e.user)||void 0===_?void 0:_.id))return t.status(403).json({message:"У вас нет доступа"});const b=v||(new Date).toISOString(),w=await a.default.create(N,(null==y?void 0:y.trim())||null,(null==E?void 0:E.trim())||null,(null==h?void 0:h.trim())||null,b,f,p);return w?t.status(200).json({message:"Пост успешно создан",result:w}):t.status(500).json({message:"Ошибка создания поста"})}catch(e){return console.error("Ошибка в createNewController: ",e.message),t.status(500).json({message:"Ошибка сервера"})}}async showImage(e,t){try{const n=e.params.fileName,r=c+n,a=await l.default.exists(r);return console.log(await l.default.exists(r)),a?t.sendFile(r):t.status(400).json({message:"Файл не найден"})}catch(e){return console.log("error showFile: ",e.message),t.status(500).json({message:"Ошибка сервера"})}}async deletePost(e,t){const{id_post:n}=e.params;return isNaN(Number(n))?t.status(400).json({message:"Неверный формат ID"}):await a.default.deletePostById(Number(n))?t.status(200).json({message:"Успешно удалено"}):t.status(500).json({message:"Ошибка при удалении"})}async updatePost(e,t){try{const{id_post:n}=e.params,r=e.body;if(isNaN(Number(n)))return t.status(400).json({message:"Неверный формат ID"});if(r.contents_to_update&&"string"==typeof r.contents_to_update)try{r.contents_to_update=JSON.parse(r.contents_to_update),r.contents_to_update=a.default.parseArrayField(r.contents_to_update)}catch(e){console.warn("⚠️ Не удалось распарсить contents_to_update:",e),r.contents_to_update=[]}if(r.images_to_delete=r.images_to_delete?a.default.parseArrayField(r.images_to_delete):[],r.contents_to_delete=r.contents_to_delete?a.default.parseArrayField(r.contents_to_delete):[],r.new_contents=r.new_contents?a.default.parseArrayField(r.new_contents):[],r.main_image_to_delete=r.main_image_to_delete?a.default.parseArrayField(r.main_image_to_delete):[],r.date&&isNaN(Date.parse(r.date)))return t.status(400).json({message:"Неверный формат даты"});const s={};if(e.files)for(const[t,n]of Object.entries(e.files)){const e=Array.isArray(n)?n:[n];s[t]=e}const o=async e=>{const t=[];for(const n of e){const e=await i.default.saveFile({path:c,fileName:n.name,sampleFile:n,type:"image"});if(e.error)throw new Error("Ошибка загрузки изображения");t.push({image_name:e.dbFileName})}return t};if(Array.isArray(r.contents_to_update))for(let e=0;e<r.contents_to_update.length;e++){const t=s[`update_${e}`];if(t){const n=await o(t);r.contents_to_update[e].images=n}}if(Array.isArray(r.new_contents))for(let e=0;e<r.new_contents.length;e++){const t=s[`new_${e}`];if(t){const n=await o(t);r.new_contents[e].images=n}}const u=[];if(e.files&&e.files.main_images){const n=Array.isArray(e.files.main_images)?e.files.main_images:[e.files.main_images];for(const e of n){const n=await i.default.saveFile({path:c,fileName:e.name,sampleFile:e,type:"image"});if(n.error)return t.status(400).json({message:"Ошибка загрузки главного изображения"});u.push(n.dbFileName)}r.new_main_image=u.map(e=>({image_name:e}))}const l=await a.default.updatePostById(Number(n),r);return(null==l?void 0:l.success)?t.status(200).json({message:"Пост успешно обновлён",newContentIds:l.newContentIds||[]}):t.status(500).json({message:"Ошибка при обновлении поста"})}catch(e){return console.error("Ошибка в updatePostNew:",e),t.status(500).json({message:"Внутренняя ошибка сервера"})}}}},1460:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(2003)),s=r(n(5260)),o=r(n(4664)),i=r(n(9896)),u=s.default.ALLOW_HOST_FILE,l=s.default.FILE_POST_URL,d=s.default.FILE_POST_PATH,c={getPostById:async function(e){try{const{error:t,rows:n}=await o.default.query("SELECT \n         p.id AS post_id, \n         p.id_type, \n         pt.type_name,\n\n         p.title_ru,\n         p.title_ky,\n         p.title_en,\n\n         p.description_ru AS post_description_ru,\n         p.description_ky AS post_description_ky,\n         p.description_en AS post_description_en,\n\n         p.date, \n         p.updated_at, \n         p.active,\n\n         pc.id AS content_id,\n         pc.description_ru AS content_description_ru,\n         pc.description_ky AS content_description_ky,\n         pc.description_en AS content_description_en,\n\n         pci.id AS content_image_id, \n         pci.image_name AS content_image_name,\n\n         img.id_image AS main_image_id,\n         img.image_name AS main_image_name\n\n       FROM post p\n       JOIN post_type pt ON pt.id_post_type = p.id_type\n       LEFT JOIN post_content pc ON pc.id_post = p.id\n       LEFT JOIN post_content_image pci ON pci.id_post_content = pc.id\n       LEFT JOIN image img ON img.id_post = p.id\n       WHERE p.id = $1;",[e]);if(t||0===n.length)return!1;const r={},a=new Map;n.forEach(e=>{e.content_id&&(r[e.content_id]||(r[e.content_id]={id:e.content_id,description:{ru:e.content_description_ru,ky:e.content_description_ky,en:e.content_description_en},images:[]}),e.content_image_id&&e.content_image_name)&&(r[e.content_id].images.some(t=>t.id===e.content_image_id)||r[e.content_id].images.push({id:e.content_image_id,name:e.content_image_name,url:`${u}${l}image-${e.content_image_name}`})),e.main_image_id&&e.main_image_name&&(a.has(e.main_image_id)||a.set(e.main_image_id,{id:e.main_image_id,url:`${u}${l}image-${e.main_image_name}`}))});const s=Object.values(r),i=Array.from(a.values());return{id:n[0].post_id,id_type:n[0].id_type,type_name:n[0].type_name,title:{ru:n[0].title_ru,ky:n[0].title_ky,en:n[0].title_en},description:{ru:n[0].post_description_ru,ky:n[0].post_description_ky,en:n[0].post_description_en},date:n[0].date,updated_at:n[0].updated_at,active:n[0].active,main_images:i,content:s}}catch(e){return console.error("error getPostById:",e.message),!1}},getAllPosts:async function(e,t,n,r){try{const a=n,s=(t-1)*n,{error:i,rows:d}=await o.default.query(`SELECT COUNT(*) AS total\n       FROM post \n       WHERE id_type = $1\n         ${r?"":"AND active = true"};`,[e]);if(i||0===d.length)return!1;const c=parseInt(d[0].total,10),{error:_,rows:f}=await o.default.query(`SELECT \n          p.id, \n          p.id_type, \n          pt.type_name,\n          p.title_ru,\n          p.title_ky,\n          p.title_en,\n          p.description_ru,\n          p.description_ky,\n          p.description_en,\n          p."date", \n          p.updated_at, \n          p.active,\n          (SELECT i.image_name \n           FROM image i \n           WHERE i.id_post = p.id \n           ORDER BY i.id_image ASC \n           LIMIT 1) AS image_name\n        FROM post p\n        LEFT JOIN post_type pt ON pt.id_post_type = p.id_type\n        WHERE p.id_type = $1\n          ${r?"":"AND p.active = true"}  \n        ORDER BY p.updated_at DESC\n        LIMIT $2 OFFSET $3;`,[e,a,s]);return!_&&{data:f.map(e=>({id:e.id,id_type:e.id_type,type_name:e.type_name,title:{ru:e.title_ru,ky:e.title_ky,en:e.title_en},description:{ru:e.description_ru,ky:e.description_ky,en:e.description_en},date:e.date,updated_at:e.updated_at,active:e.active,image_name:e.image_name?`${u}${l}image-${e.image_name}`:null})),total:c,currentPage:t,totalPages:Math.ceil(c/a)}}catch(e){return console.log("error getAllPosts: ",e.message),!1}},create:async function(e,t,n,r,a,s,i){try{const{error:u,rows:l}=await o.default.query("CALL p_insert_post($1::int, $2::varchar, $3::varchar, $4::varchar, $5::timestamp, $6::jsonb, $7::text[]);",[e,t,n,r,a,JSON.stringify(s),i]);return u?(console.error("Ошибка при создании поста:",u),!1):l}catch(e){return console.error("Ошибка в create:",e.message),!1}},deletePostById:async function(e){try{const{rows:t}=await o.default.query("SELECT image_name FROM post_content_image WHERE id_post_content IN \n       (SELECT id FROM post_content WHERE id_post = $1)",[e]),{rows:n}=await o.default.query("SELECT image_name FROM image WHERE id_post = $1",[e]),r=[...t,...n];return await Promise.all(r.map(async e=>{const t=a.default.join(`${d}image-${e.image_name}`);if(i.default.existsSync(t))try{await i.default.promises.unlink(t)}catch(t){console.error(`Ошибка удаления файла ${e.image_name}:`,t)}})),await o.default.query("DELETE FROM image WHERE id_post = $1",[e]),await o.default.query("DELETE FROM post_content_image WHERE id_post_content IN \n       (SELECT id FROM post_content WHERE id_post = $1)",[e]),await o.default.query("DELETE FROM post_content WHERE id_post = $1",[e]),await o.default.query("DELETE FROM post WHERE id = $1",[e]),!0}catch(e){return console.error("Ошибка при удалении поста и изображений:",e.message),!1}},updatePostById:async function(e,t){try{const{title_ru:n,title_ky:r,title_en:s,id_type:u,date:l,active:c,images_to_delete:_,main_image_to_delete:f,new_main_image:p,contents_to_update:m,contents_to_delete:g,new_contents:y}=t,E=[],h=[];void 0!==n&&(E.push(`title_ru = $${h.length+1}`),h.push(n)),void 0!==r&&(E.push(`title_ky = $${h.length+1}`),h.push(r)),void 0!==s&&(E.push(`title_en = $${h.length+1}`),h.push(s)),void 0!==u&&(E.push(`id_type = $${h.length+1}`),h.push(u)),void 0!==l&&(E.push(`"date" = $${h.length+1}`),h.push(l));const v="false"!==c&&(c||!0);if(E.push(`active = $${h.length+1}`),h.push(v),E.length>0&&await o.default.query(`UPDATE post SET ${E.join(", ")} WHERE id = $${h.length+1}`,[...h,e]),_&&_.length>0){const e=await o.default.query("SELECT image_name FROM post_content_image WHERE id = ANY($1)",[_]);for(const t of e.rows){const e=a.default.join(`${d}image-${t.image_name}`);i.default.existsSync(e)&&i.default.unlinkSync(e)}await o.default.query("DELETE FROM post_content_image WHERE id = ANY($1)",[_])}if(f&&f.length>0){const{rows:t}=await o.default.query("SELECT image_name FROM image WHERE id_image = ANY($1) AND id_post = $2",[f,e]);for(const e of t){const t=a.default.join(`${d}image-${e.image_name}`);i.default.existsSync(t)&&i.default.unlinkSync(t)}await o.default.query("DELETE FROM image WHERE id_image = ANY($1) AND id_post = $2",[f,e])}if(p&&Array.isArray(p)){const t=p.map(t=>o.default.query("INSERT INTO image (id_post, image_name) VALUES ($1, $2)",[e,t.image_name]));await Promise.all(t)}if(m&&m.length>0)for(const t of m){const{id_content:n,description_ru:r,description_ky:a,description_en:s,images:i}=t,u=[],l=[];if(void 0!==r&&(u.push(`description_ru = $${l.length+1}`),l.push(r)),void 0!==a&&(u.push(`description_ky = $${l.length+1}`),l.push(a)),void 0!==s&&(u.push(`description_en = $${l.length+1}`),l.push(s)),u.length>0&&(l.push(n,e),await o.default.query(`UPDATE post_content SET ${u.join(", ")} WHERE id = $${l.length-1} AND id_post = $${l.length}`,l)),i&&i.length>0){const e=i.map(e=>o.default.query("INSERT INTO post_content_image (id_post_content, image_name) VALUES ($1, $2)",[n,e.image_name]));await Promise.all(e)}}if(g&&g.length>0)for(const t of g){const n=await o.default.query("SELECT image_name FROM post_content_image WHERE id_post_content = $1",[t]);for(const e of n.rows){const t=a.default.join(`${d}image-${e.image_name}`);i.default.existsSync(t)&&i.default.unlinkSync(t)}await o.default.query("DELETE FROM post_content_image WHERE id_post_content = $1",[t]),await o.default.query("DELETE FROM post_content WHERE id = $1 AND id_post = $2",[t,e])}const N=[];if(y&&y.length>0)for(const[t,n]of y.entries()){const{description_ru:r,description_ky:a,description_en:s,images:i}=n,u=(await o.default.query("INSERT INTO post_content (id_post, description_ru, description_ky, description_en, content_order) \n           VALUES ($1, $2, $3, $4, $5) RETURNING id",[e,r||"",a||"",s||"",t])).rows[0].id;if(N.push({index:t,id_post_content:u}),i&&i.length>0){const e=i.map(e=>o.default.query("INSERT INTO post_content_image (id_post_content, image_name) \n               VALUES ($1, $2)",[u,e.image_name]));await Promise.all(e)}}const{rows:b}=await o.default.query("SELECT description_ru, description_ky, description_en\n        FROM post_content\n        WHERE id_post = $1\n        ORDER BY id ASC\n        LIMIT 1",[e]);if(b.length>0){const t=b[0];await o.default.query("UPDATE post \n          SET description_ru = $1, description_ky = $2, description_en = $3\n          WHERE id = $4",[t.description_ru,t.description_ky,t.description_en,e])}return{success:!0,newContentIds:N}}catch(e){return console.error("Error updating post:",e),{success:!1}}},parseArrayField:function(e){if(!e)return[];if(Array.isArray(e))return e;if("string"==typeof e){if(e.trim().startsWith("["))try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return console.error("Ошибка парсинга JSON:",e),[]}return e.split(",").map(e=>Number(e.trim())).filter(e=>!isNaN(e))}return[]}};t.default=c},1725:e=>{e.exports=JSON.parse('{"token":{"notFound":"Токен табылган жок!","invalid":"Токен жараксыз!","permission":"Маалыматты алууга уруксатыңыз жок!","expired":"Токендин мөөнөтү бүттү!","generateError":"Токен жаратуу болбой калды"},"success":"Ийгиликтүү!","error":"Ката!","unauth":"Логин же сырсөз туура эмес!","inValidFormat":"Маалыматтарды туура толтуруңуз!","noValidEmail":"Электрондук дарек туура эмес!","noToken":"Токен жок!","emailUsed":"Email колдонууда","userNotFound":"Колдонуучу табылган жок","emailAlreadyInUse":"Сиз мурунтан эле колдонуп жаткан электрондук почтага өзгөртө албайсыз","changedNumber":"Телефон номери ийгиликтүү өзгөртүлдү","couldNotChangeTheNumber":"Номерди өзгөртүү ишке ашкан жок","phoneAlreadyInUse":"Сиз мурунтан эле колдонуп жаткан телефон номерге өзгөртө албайсыз","passwordAlreadyInUse":"Сиз мурунтан эле колдонуп жүргөн сырсөздү алмаштыра албайсыз","changePassword":"Сырсөздү ийгиликтүү өзгөрттүңүз","couldNotChangeThePassword":"Сырсөз өзгөргөн жок","fileIsMissing":"Файл жок","fileNotFound":"Файл табылган жок!"}')},1889:e=>{e.exports=require("i18next-http-middleware")},2003:e=>{e.exports=require("path")},2449:e=>{e.exports=require("pg")},2652:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(4572);t.default=(e,t,n,a)=>(console.log("errorHandler","=>",{url:t.url,error:e,tFunctionAvailable:"function"==typeof t.t}),(0,r.sendError)(n,null==e?void 0:e.message))},2669:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(3594));t.default=new class{async vehicleList(e,t){try{const e=await a.default.getVehicles();return e?t.status(200).json({message:"Успешно",data:e}):t.status(404).json({message:"Ошибка"})}catch(e){return t.status(500).json({message:"Ошибка сервера"})}}async guideList(e,t){try{const e=await a.default.getGuide();return e?t.status(200).json({message:"Успешно",data:e}):t.status(404).json({message:"Ошибка"})}catch(e){return t.status(500).json({message:"Ошибка сервера"})}}}},2828:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(7252)),s=r(n(5905)),o=a.default.Router();o.post("/login",s.default.login),o.post("/recourse",s.default.recourse),o.get("/recourse/list",s.default.getAllResourseController),o.get("/recourse/id",s.default.getResourseByIdController),o.patch("/recourse/read/:id",s.default.markAsRead),o.post("/feedback",s.default.feedback),o.get("/feedback/list",s.default.getAllFeedbackController),o.get("/feedback/id",s.default.getFeedbackIdController),t.default=o},2945:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(4122));t.default=a.default},3410:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={loginSchema:{type:"object",properties:{login:{type:["string","number"],required:!0,minLength:1},password:{type:"string",required:!0,minLength:1}}}}},3481:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(829)),s=r(n(9095)),o=r(n(5260)),i={generateAccessToken:e=>a.default.sign({data:s.default.encrypt(JSON.stringify(e))},o.default.JWT_ACCESS_SECRET,{expiresIn:Number(o.default.JWT_EXPIRE_HOURS)}),getTokenData:e=>{try{const t=e.split(" ");if("Bearer"!=t[0])return!1;const n=a.default.verify(t[1],o.default.JWT_ACCESS_SECRET);if(!n||!n.data)return!1;const r=JSON.parse(s.default.decrypt(n.data));return Object.assign({},r)}catch(e){return console.log("error getTokenData: ",e.message),!1}},generateLinkToken:(e,t=Number(o.default.EMAIL_JWT_EXPIRE_HOURSE))=>a.default.sign({data:e},o.default.JWT_ACCESS_SECRET,{expiresIn:t}),getTokenDataLink:e=>{try{const t=a.default.verify(e,o.default.JWT_ACCESS_SECRET);if(!t||"object"!=typeof t||!t.data)return!1;const n=t.data;return Object.assign({},n)}catch(e){return console.log("error getTokenDataLink: ",e.message),!1}}};t.default=i},3553:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(214));t.default=a.default},3594:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(4664));t.default={getVehicles:async function(){try{const{rows:e,error:t}=await a.default.query("SELECT id, vehicle_name FROM vehicle ORDER BY id;",[]);return!t&&e}catch(e){return console.log("error getModel: ",e.message),!1}},getGuide:async function(){try{const{rows:e,error:t}=await a.default.query("SELECT id_guide, guide_name FROM guide ORDER BY id_guide;",[]);return!t&&e}catch(e){return console.log("error getGuide: ",e.message),!1}}}},3903:e=>{e.exports=require("uuid")},3978:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(6427)),s=r(n(8495)),o=r(n(1889)),i=r(n(970)),u=r(n(1725)),l={ru:{translation:i.default},kg:{translation:u.default}};a.default.use(s.default).use(o.default.LanguageDetector).init({resources:l,defaultNS:"translation",detection:{order:["querystring","cookie"],cache:["cookie"],lookupQuerystring:"lang",lookupCookie:"lang"},fallbackLng:["ru","kg","ky"],preload:["ru"]});const d=o.default.handle(a.default);t.default=d},4122:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(7252)),s=r(n(1235)),o=r(n(780)),i=a.default.Router();i.get("/get/id",s.default.getPostByIdController),i.post("/create",o.default.isAdminToken,s.default.createController),i.get("/get/:id",s.default.getAllPostsController),i.get("/image_file/show/:fileName",s.default.showImage),i.delete("/delete/:id_post",o.default.isAdminToken,s.default.deletePost),i.put("/update/:id_post",o.default.isAdminToken,s.default.updatePost),t.default=i},4251:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(5260));t.default=function(e,t){let n;n=-1!==a.default.ALLOW_HOST_LIST.indexOf(e.headers.origin||"")?{origin:!0,credentials:!0}:{origin:!1},t(null,n)}},4572:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sendSuccess=t.sendError=t.send=void 0;const n=(e,t,n,r,a)=>e.status(a).json({data:t,message:n,error:r});t.send=n,t.sendError=(e,t,r=!1,a=400)=>n(e,r,t,!0,a),t.sendSuccess=(e,t,r=!0,a=200)=>n(e,r,t,!1,a)},4664:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.db=void 0,t.connectionCheck=async function(){try{return o.query("select 1 as answer;",[]).then(e=>{console.log("Connected to PG=>",e.rows[0]&&1==e.rows[0].answer)}).catch(e=>{throw console.error("Error executing query: ",e.stack),new Error(e)})}catch(e){return{rows:[],rowCount:0,error:e.message}}},t.transaction=async function(e){const t=await o.connect();try{await t.query("BEGIN");const n=await e(t);return await t.query("COMMIT"),n}catch(e){throw await t.query("ROLLBACK"),e}finally{t.release()}};const a=n(2449),s=r(n(5260)),o=new a.Pool({host:s.default.DBSERVER,port:Number(s.default.DBPORT),database:s.default.DBNAME,user:s.default.DBUSER,password:s.default.DBPASS,max:Number(s.default.DBPG_MAX_CONNECTIONS),idleTimeoutMillis:Number(s.default.DBPG_IDLETIMEOUTMILLLIS),connectionTimeoutMillis:Number(s.default.DBPG_CONNECTIONTIMEOUTMILLES)});t.db=o,t.default={query:async function(e,t){try{"development"===s.default.NODE_ENV&&console.log("PG query: ",{text:e,params:t});const{rows:n,rowCount:r,command:a}=await o.query(e,t);return{rows:n,rowCount:r,error:!1,command:a}}catch(n){return console.log("PG ERROR=>",n),console.log("PG query: ",{text:e,params:t}),{rows:[],rowCount:0,error:n.message}}}}},5260:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(n(818)).default.config();const a=Number(process.env.PORT)||9e3,s=process.env.JWT_ACCESS_SECRET||"",o=process.env.JWT_EXPIRE_HOURS||"30h",i=process.env.DBUSER||"postgres",u=process.env.DBPASS||"postgres",l=process.env.DBSERVER||"localhost",d=process.env.DBPORT||5432,c=process.env.DBNAME||"hyundai",_=process.env.DBNAME2||"postgres",f=process.env.DBPG_MAX_CONNECTIONS||20,p=process.env.DBPG_IDLETIMEOUTMILLLIS||3e4,m=process.env.DBPG_CONNECTIONTIMEOUTMILLES||2e3,g=Number(process.env.ID_ADMIN_ROLE)||1,y=process.env.ALLOW_HOST||`http://localhost:${a}`,E=process.env.ALLOW_HOST_FILE||`http://localhost:${a}`,h=process.env.ALLOW_HOST_LIST?JSON.parse(process.env.ALLOW_HOST_LIST):[y],v=process.env.EMAIL_JWT_EXPIRE_HOURSE||108e3,N={PORT:a,NODE_ENV:"production",JWT_ACCESS_SECRET:s,JWT_EXPIRE_HOURS:o,DBUSER:i,DBPASS:u,DBSERVER:l,DBPORT:d,DBNAME:c,DBNAME2:_,DBPG_MAX_CONNECTIONS:f,DBPG_IDLETIMEOUTMILLLIS:p,DBPG_CONNECTIONTIMEOUTMILLES:m,ALLOW_HOST:y,ALLOW_HOST_LIST:h,ALLOW_HOST_FILE:E,ID_ADMIN_ROLE:g,FILE_POST_PATH:process.env.FILE_POST_PATH||"",FILE_POST_URL:process.env.FILE_POST_URL||"",EMAIL_JWT_EXPIRE_HOURSE:v,FILE_BANNER_PATH:process.env.FILE_BANNER_PATH||"",FILE_BANNER_URL:process.env.FILE_BANNER_URL||""};t.default=N},5490:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(7912));t.default=a.default},5560:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(9896)),s={exists:async e=>!!await a.default.promises.stat(e).catch(e=>("true"===process.env.DEBUG_MODE&&console.debug(e),!1)),deleteFile:async e=>await a.default.promises.unlink(e).catch(e=>("true"===process.env.DEBUG_MODE&&console.debug(e),!1)),listDir:async e=>await a.default.promises.readdir(e).catch(e=>("true"===process.env.DEBUG_MODE&&console.debug(e),[])),write:async(e,t)=>await a.default.promises.writeFile(e,t,"utf8"),read:async e=>await a.default.promises.readFile(e,"utf8")};t.default=s},5574:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(7265),s=r(n(4664)),o={userLogin:async function(e,t){try{const n=(0,a.md5)(t),{rows:r,rowCount:o}=await s.default.query("SELECT * FROM public.fn_auth($1, $2);",[e,n]);if(o&&o>0){const{id_user:e,roles:t,surname:n,name:a}=r[0];return{id:e,role:t,surname:n,name:a}}return!1}catch(e){return console.log("error userLogin: ",e.message),!1}},saveRecourse:async function(e,t,n,r,a,o){try{const{error:i,rows:u}=await s.default.query("INSERT INTO service(name, phone, auto, release, mileage, recourse)\n       VALUES($1, $2, $3, $4, $5, $6)\n       RETURNING id_service;",[e,t,n,r,a,o]);return!i&&u[0]}catch(e){return console.log("error saveRecourse: ",e.message),!1}},getAllResourse:async function(e,t){try{const n=t,r=(e-1)*t,{error:a,rows:o}=await s.default.query("SELECT * FROM service LIMIT $1 OFFSET $2;",[n,r]);return!a&&o}catch(e){return console.log("error getAllResourse: ",e.message),!1}},getResourseById:async function(e){try{const{error:t,rows:n}=await s.default.query("SELECT * FROM service WHERE id_service = $1;",[e]);return!t&&n[0]}catch(e){return console.log("error getResourseById: ",e.message),!1}},markAsRead:async function(e){try{const{error:t,rows:n}=await s.default.query("UPDATE service\n       SET active = false, date = CURRENT_TIMESTAMP\n       WHERE id_service = $1\n       RETURNING *;",[e]);return!t&&n[0]}catch(e){return console.log("error markAsRead: ",e.message),!1}},saveFeedback:async function(e,t,n,r,a){try{const{error:o,rows:i}=await s.default.query("INSERT INTO feedback(name, phone, id_brand, id_model, wording)\n       VALUES($1, $2, $3, $4, $5)\n       RETURNING id_feedback;",[e,t,n,r,a]);return!o&&i[0]}catch(e){return console.log("error saveFeedback: ",e.message),!1}},getAllFeedback:async function(e,t){try{const n=t,r=(e-1)*t,{error:a,rows:o}=await s.default.query('SELECT f.id_feedback, \n              f."name", \n              f.phone, \n              f.id_brand,\n              b.brand_name,\n              f.id_model,\n              m.model_name,\n              f.wording,\n              f"date",\n              f.active\n       FROM feedback f \n       LEFT JOIN brand b USING(id_brand)\n       LEFT JOIN model m USING(id_model)\n       LIMIT $1 OFFSET $2;',[n,r]);return!a&&o}catch(e){return console.log("error getAllFeedback: ",e.message),!1}},getFeedbackById:async function(e){try{const{error:t,rows:n}=await s.default.query('SELECT f.id_feedback, \n              f."name", \n              f.phone, \n              f.id_brand,\n              b.brand_name,\n              f.id_model,\n              m.model_name,\n              f.wording,\n              f"date",\n              f.active\n       FROM feedback f \n       LEFT JOIN brand b USING(id_brand)\n       LEFT JOIN model m USING(id_model)\n       WHERE id_feedback = $1;',[e]);return!t&&n[0]}catch(e){return console.log("error getFeedbackById: ",e.message),!1}}};t.default=o},5684:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(2828));t.default=a.default},5781:e=>{e.exports=require("jsonschema")},5905:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(4572),s=r(n(8416)),o=r(n(5260)),i=r(n(3481)),u=r(n(5574)),l=r(n(3410));t.default=new class{async login(e,t){try{if(!(0,s.default)(e.body,l.default.loginSchema))return(0,a.sendError)(t,e.t("inValidFormat"));const{login:n,password:r}=e.body,d=await u.default.userLogin(n,r);if(d&&d.id){const n=Date.now()+60*parseInt(o.default.JWT_EXPIRE_HOURS)*60*1e3,r=Array.isArray(d.role)?d.role:[d.role],s=i.default.generateAccessToken({id:d.id,r,s:d.surname,n:d.name,exp:n});if(!s)return(0,a.sendError)(t,e.t("token.generateError"));if(d)return(0,a.sendSuccess)(t,e.t("success"),{id:d.id,r,s:d.surname,n:d.name,exp:n,token:s,tokenType:"Bearer",expiresIn:60*parseInt(o.default.JWT_EXPIRE_HOURS)})}return(0,a.sendError)(t,e.t("unauth"),!1,401)}catch(n){return console.log("error login: ",n.message),(0,a.sendError)(t,e.t("error"),!1,400)}}async recourse(e,t){try{const{name:n,phone:r,auto:a,release:s,mileage:o,recourse:i}=e.body,l=await u.default.saveRecourse(n,r,a,s,o,i);return l?t.status(200).json({message:"Успешно",data:l}):t.status(400).json({message:"Ошибка"})}catch(e){return console.log("error recourse: ",e.message),!1}}async getAllResourseController(e,t){try{const{page:n=1,offset:r=10}=e.query,a=Number(n),s=Number(r),o=await u.default.getAllResourse(a,s);return o?t.status(200).json({message:"Успешно",data:o}):t.status(400).json({message:"Ошибка"})}catch(e){return console.log("error getAllResourseController: ",e.message),!1}}async getResourseByIdController(e,t){try{const{id_service:n}=e.query,r=await u.default.getResourseById(Number(n));return r?t.status(200).json({message:"Успешно",data:r}):t.status(400).json({message:"Ошибка"})}catch(e){return console.log("error getResourseByIdController: ",e.message),!1}}async markAsRead(e,t){try{const{id:n}=e.params,r=await u.default.markAsRead(Number(n));return console.log(r),r?t.status(200).json({message:"Помечено как прочитанное",data:r}):t.status(404).json({message:"Запись не найдена"})}catch(e){return console.error("Error in markAsRead: ",e.message),t.status(500).json({message:"Ошибка при обновлении записи"})}}async feedback(e,t){try{const{name:n,phone:r,id_brand:a,id_model:s,wording:o}=e.body,i=await u.default.saveFeedback(n,r,a,s,o);return i?t.status(200).json({message:"Успешно",data:i}):t.status(400).json({message:"Ошибка"})}catch(e){return console.log("error feedback: ",e.message),!1}}async getAllFeedbackController(e,t){try{const{page:n=1,offset:r=10}=e.query,a=Number(n),s=Number(r),o=await u.default.getAllFeedback(a,s);return o?t.status(200).json({message:"Успешно",data:o}):t.status(400).json({message:"Ошибка"})}catch(e){return console.log("error getAllFeedbackController: ",e.message),!1}}async getFeedbackIdController(e,t){try{const{id_feedback:n}=e.query,r=await u.default.getFeedbackById(Number(n));return r?t.status(200).json({message:"Успешно",data:r}):t.status(400).json({message:"Ошибка"})}catch(e){return console.log("error getFeedbackIdController: ",e.message),!1}}}},5946:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(5560)),s=n(3903),o={saveFile:async function({path:e,sampleFile:t,ALLOWED_EXTENSIONS:n=["pdf","jpg","jpeg","png","svg"],type:r,allowTypePrefix:a=!0}){try{if(!t||!t.name)return console.error("Ошибка: файл не передан или имеет некорректную структуру"),{error:!0,dbFileName:""};const o=t.name.split(".").pop();if(!o)return{error:!0,dbFileName:""};if(!t.mimetype.startsWith("image/")&&!n.includes(o))return{error:!0,dbFileName:""};const i=`${(0,s.v4)()}.${o}`,u=`${e}${a?`${r}-`:""}${i}`;return await t.mv(u),{error:!1,dbFileName:i}}catch(e){return console.log("error saveFile: ",e.message),{error:!0,dbFileName:""}}},removeFile:async function(e,t){a.default.deleteFile(`${e}${t}`)}};t.default=o},6376:e=>{e.exports=require("express-fileupload")},6427:e=>{e.exports=require("i18next")},6716:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={postSchema:{type:"object",properties:{id_type:{type:"string",minLength:1,required:!0},title:{type:"string",minLength:1},description:{type:"string",minLength:1},images:{type:"array",items:{type:"string"}},date:{type:["string","date"]}}},postNewSchema:{type:"object",properties:{id_type:{type:"string",minLength:1,required:!0},title_ru:{type:"string",minLength:1,required:!0},title_ky:{type:"string",minLength:1,required:!0},title_en:{type:"string",minLength:1,required:!0},date:{type:["string","date"]},contents:{type:"array",required:!0,items:{type:"object",properties:{description_ru:{type:"string",minLength:1,required:!0},description_ky:{type:"string",minLength:1,required:!0},description_en:{type:"string",minLength:1,required:!0},images:{type:"array",items:{type:"string"},required:!0}}}}}}}},6799:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(7252),s=r(n(5684)),o=r(n(2945)),i=r(n(5490)),u=r(n(3553)),l=(0,a.Router)().use("/user",s.default).use("/shared",i.default).use("/post",o.default).use("/banner",u.default);l.use((e,t)=>{t.status(404).json({error:"API not found"})}),t.default=(0,a.Router)().use("/site/api",l)},6898:e=>{e.exports=require("cookie-parser")},7151:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(7544)),s=r(n(5946)),o=r(n(5260)),i=r(n(5560)),u=o.default.FILE_BANNER_PATH;t.default=new class{async saveBannerController(e,t){var n;try{const{title_ru:r,title_ky:o,title_en:i}=e.body;let l=null;if(null===(n=e.files)||void 0===n?void 0:n.image){const n=Array.isArray(e.files.image)?e.files.image[0]:e.files.image,r=await s.default.saveFile({path:u,fileName:n.name,sampleFile:n,type:"image"});if(r.error)return t.status(400).json({message:"Ошибка загрузки изображения"});l=r.dbFileName}const d=await a.default.saveBanner(r,o,i,l);return d?t.status(200).json({message:"Баннер успешно создан",data:d}):t.status(404).json({message:"Ошибка создания баннера"})}catch(e){return console.error("Ошибка в saveBannerController: ",e.message),t.status(500).json({message:"Ошибка сервера"})}}async getBannerController(e,t){try{const e=await a.default.getBanner();return e?t.status(200).json({message:"Успешно",data:e}):t.status(404).json({message:"Ошибка получения баннера"})}catch(e){return console.error("Ошибка в getBannerController: ",e.message),t.status(500).json({message:"Ошибка сервера"})}}async showImage(e,t){try{const n=e.params.fileName,r=u+n,a=await i.default.exists(r);return console.log(await i.default.exists(r)),a?t.sendFile(r):t.status(400).json({message:"Файл не найден"})}catch(e){return console.log("error showFile: ",e.message),t.status(500).json({message:"Ошибка сервера"})}}async deleteBannerController(e,t){try{const{id_banner:n}=e.query;return await a.default.existIdBanner(Number(n))?await a.default.deleteBanner(Number(n))?t.status(200).json({message:"Успешно удалено"}):t.status(404).json({message:"Ошибка удаления баннера"}):t.status(400).json({message:"По такой id нет данных"})}catch(e){return console.error("Ошибка в getBannerController: ",e.message),t.status(500).json({message:"Ошибка сервера"})}}async updateBannerController(e,t){var n;try{const{id_banner:r}=e.query,{title_ru:o,title_ky:i,title_en:l}=e.body;if(!r)return t.status(400).json({message:"ID обязателен"});if(!await a.default.existIdBanner(Number(r)))return t.status(400).json({message:"По такой id нет данных"});let d;if(null===(n=e.files)||void 0===n?void 0:n.image){const n=Array.isArray(e.files.image)?e.files.image[0]:e.files.image,r=await s.default.saveFile({path:u,fileName:n.name,sampleFile:n,type:"image"});if(r.error)return t.status(400).json({message:"Ошибка загрузки изображения"});d=r.dbFileName}const c=await a.default.updateBanner(Number(r),o,i,l,d);return c?t.status(200).json({message:"Успешно обновлено",updateResult:c}):t.status(400).json({message:"Ошибка обновления файлов в БД"})}catch(e){return console.error("Ошибка в updateVehicleFilesController: ",e),t.status(500).json({message:"Внутренняя ошибка сервера"})}}}},7174:e=>{e.exports=require("compression")},7252:e=>{e.exports=require("express")},7265:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.md5=function(e){return a.default.createHash("md5").update(e).digest("hex")};const a=r(n(8749))},7544:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(5260)),s=r(n(4664)),o=r(n(2003)),i=r(n(9896)),u=a.default.ALLOW_HOST_FILE,l=a.default.FILE_BANNER_URL,d=a.default.FILE_BANNER_PATH,c={saveBanner:async function(e,t,n,r){try{const{error:a,rows:o}=await s.default.query("INSERT INTO banner(title_ru, title_ky, title_en, image)\n       VALUES($1, $2, $3, $4)\n       RETURNING *;",[e,t,n,r]);return!a&&o}catch(e){return console.log("error saveBanner: ",e.message),!1}},getBanner:async function(){try{const{error:e,rows:t}=await s.default.query("SELECT id_banner, title_ru, title_ky, title_en, image FROM banner ORDER BY id_banner;",[]);return!e&&t.map(e=>({id_banner:e.id_banner,banner_title_ru:e.title_ru,banner_title_ky:e.title_ky,banner_title_en:e.title_en,banner_url:e.image?`${u}${l}image-${e.image}`:null}))}catch(e){return console.log("error getBanner: ",e.message),!1}},updateBanner:async function(e,t,n,r,a){try{const{error:u,rows:l}=await s.default.query("SELECT title_ru, title_ky, title_en, image FROM banner WHERE id_banner = $1;",[e]);if(u||0===l.length)return!1;const c=l[0];if(a&&c.image){const e=o.default.join(`${d}image-${c.image}`);i.default.existsSync(e)&&i.default.unlinkSync(e)}const _=void 0!==t?t:c.title_ru,f=void 0!==n?n:c.title_ky,p=void 0!==r?r:c.title_en,m=void 0!==a?a:c.image,{error:g}=await s.default.query("UPDATE banner SET title_ru = $1, title_ky = $2, title_en = $3, image = $4 WHERE id_banner = $5;",[_,f,p,m,e]);return!g}catch(e){return console.log("error updateBanner: ",e.message),!1}},deleteBanner:async function(e){try{const{error:t,rows:n}=await s.default.query("SELECT image FROM banner WHERE id_banner = $1;",[e]);if(t||0===n.length)return!1;const r=n[0].image;if(r){const e=o.default.join(`${d}image-${r}`);i.default.existsSync(e)&&i.default.unlinkSync(e)}const{error:a}=await s.default.query("DELETE FROM banner WHERE id_banner = $1;",[e]);return!a}catch(e){return console.log("Ошибка deleteBanner: ",e.message),!1}},existIdBanner:async function(e){try{const{error:t,rows:n}=await s.default.query("SELECT EXISTS(SELECT * FROM banner WHERE id_banner = $1)",[e]);return!t&&n[0].exists}catch(e){return console.error("Ошибка existIdBanner: ",e.message),null}}};t.default=c},7806:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(7252)),s=r(n(7174)),o=r(n(6898)),i=r(n(8577)),u=r(n(6376)),l=r(n(218)),d=r(n(5260)),c=r(n(3978)),_=r(n(4251)),f=r(n(2652)),p=n(4664),m=r(n(6799)),g=(0,a.default)();(async()=>{try{const e=d.default.PORT;g.use(a.default.json()),g.use((0,i.default)(_.default)),g.use(f.default),g.use(c.default),g.use((0,s.default)()),g.use((0,o.default)()),g.use((0,u.default)({limits:{fileSize:104857600}})),g.use(m.default),g.use("/",a.default.static("public")),g.use("/",l.default),g.listen(e,async()=>{console.log("Application listening on port: ",e),await(0,p.connectionCheck)()})}catch(e){console.log("error startServer: ",e.message)}})()},7912:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(7252)),s=r(n(2669)),o=a.default.Router();o.get("/vehicle",s.default.vehicleList),o.get("/guide",s.default.guideList),t.default=o},8416:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(5781);t.default=(e,t)=>(new r.Validator).validate(e,t).valid},8495:e=>{e.exports=require("i18next-node-fs-backend")},8577:e=>{e.exports=require("cors")},8749:e=>{e.exports=require("crypto")},9095:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(8749));var s=Buffer.from("3e10bb241d611ac910af5d8690011e6c","hex"),o=Buffer.from("34db16c275e2895654e798794f6e47ae","hex");const i="aes-128-cbc";t.default={encrypt:function(e){var t=a.default.createCipheriv(i,o,s);return t.update(e,"utf8","base64")+t.final("base64")},decrypt:function(e){var t=a.default.createDecipheriv(i,o,s);return t.update(e,"base64","utf8")+t.final("utf8")}}},9896:e=>{e.exports=require("fs")}},t={},n=function n(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}(7806);app=n})();